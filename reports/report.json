{"created": 1745585700.69296, "duration": 71.94309091567993, "exitcode": 1, "root": "/home/henrique.luis/repos/s3-specs", "environment": {}, "summary": {"failed": 1, "total": 1, "collected": 1}, "collectors": [{"nodeid": "", "outcome": "passed", "result": [{"nodeid": "src/s3_specs/docs/bucket_sharing_cli.py", "type": "Module"}]}, {"nodeid": "src/s3_specs/docs/bucket_sharing_cli.py", "outcome": "passed", "result": [{"nodeid": "src/s3_specs/docs/bucket_sharing_cli.py::test_generate_presigned_url_cli[mgc-presign-put]", "type": "Function", "lineno": 88}]}], "tests": [{"nodeid": "src/s3_specs/docs/bucket_sharing_cli.py::test_generate_presigned_url_cli[mgc-presign-put]", "lineno": 88, "outcome": "failed", "keywords": ["test_generate_presigned_url_cli[mgc-presign-put]", "parametrize", "mgc", "pytestmark", "mgc-presign-put", "bucket_sharing_cli.py", "bucket_sharing", "presign", "src/s3_specs/docs/__init__.py", "s3-specs"], "setup": {"duration": 70.61462081300124, "outcome": "passed", "log": [{"name": "botocore.credentials", "msg": "Found credentials in shared credentials file: ~/.aws/credentials", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/home/henrique.luis/repos/s3-specs/.venv/lib/python3.13/site-packages/botocore/credentials.py", "filename": "credentials.py", "module": "credentials", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 1278, "funcName": "load", "created": 1745585628.9734342, "msecs": 973.0, "relativeCreated": 1072.220425, "thread": 137596227127104, "threadName": "MainThread", "processName": "MainProcess", "process": 360708, "taskName": null}, {"name": "botocore.configprovider", "msg": "Found endpoint for s3 via: config_global.", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/home/henrique.luis/repos/s3-specs/.venv/lib/python3.13/site-packages/botocore/configprovider.py", "filename": "configprovider.py", "module": "configprovider", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 974, "funcName": "provide", "created": 1745585629.054324, "msecs": 54.0, "relativeCreated": 1153.11006, "thread": 137596227127104, "threadName": "MainThread", "processName": "MainProcess", "process": 360708, "taskName": null}, {"name": "botocore.credentials", "msg": "Found credentials in shared credentials file: ~/.aws/credentials", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/home/henrique.luis/repos/s3-specs/.venv/lib/python3.13/site-packages/botocore/credentials.py", "filename": "credentials.py", "module": "credentials", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 1278, "funcName": "load", "created": 1745585629.0701349, "msecs": 70.0, "relativeCreated": 1168.920888, "thread": 137596227127104, "threadName": "MainThread", "processName": "MainProcess", "process": 360708, "taskName": null}, {"name": "botocore.configprovider", "msg": "Found endpoint for s3 via: config_global.", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/home/henrique.luis/repos/s3-specs/.venv/lib/python3.13/site-packages/botocore/configprovider.py", "filename": "configprovider.py", "module": "configprovider", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 974, "funcName": "provide", "created": 1745585629.118268, "msecs": 118.0, "relativeCreated": 1217.054188, "thread": 137596227127104, "threadName": "MainThread", "processName": "MainProcess", "process": 360708, "taskName": null}, {"name": "root", "msg": "Bucket 'test-bucket-78bda3b35cdb494' confirmed as deleted.", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/home/henrique.luis/repos/s3-specs/src/s3_specs/docs/s3_helpers.py", "filename": "s3_helpers.py", "module": "s3_helpers", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 61, "funcName": "delete_bucket_and_wait", "created": 1745585633.218291, "msecs": 218.0, "relativeCreated": 5317.07718, "thread": 137596227127104, "threadName": "MainThread", "processName": "MainProcess", "process": 360708, "taskName": null}, {"name": "root", "msg": "Bucket 'test-bucket-7482e76b68a44cf' confirmed as deleted.", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/home/henrique.luis/repos/s3-specs/src/s3_specs/docs/s3_helpers.py", "filename": "s3_helpers.py", "module": "s3_helpers", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 61, "funcName": "delete_bucket_and_wait", "created": 1745585696.1861238, "msecs": 186.0, "relativeCreated": 68284.909951, "thread": 137596227127104, "threadName": "MainThread", "processName": "MainProcess", "process": 360708, "taskName": null}, {"name": "root", "msg": "Region: None", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/home/henrique.luis/repos/s3-specs/src/s3_specs/docs/conftest.py", "filename": "conftest.py", "module": "conftest", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 75, "funcName": "test_params", "created": 1745585696.186769, "msecs": 186.0, "relativeCreated": 68285.555213, "thread": 137596227127104, "threadName": "MainThread", "processName": "MainProcess", "process": 360708, "taskName": null}, {"name": "botocore.credentials", "msg": "Found credentials in shared credentials file: ~/.aws/credentials", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/home/henrique.luis/repos/s3-specs/.venv/lib/python3.13/site-packages/botocore/credentials.py", "filename": "credentials.py", "module": "credentials", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 1278, "funcName": "load", "created": 1745585696.2049227, "msecs": 204.0, "relativeCreated": 68303.708895, "thread": 137596227127104, "threadName": "MainThread", "processName": "MainProcess", "process": 360708, "taskName": null}, {"name": "botocore.configprovider", "msg": "Found endpoint for s3 via: config_global.", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/home/henrique.luis/repos/s3-specs/.venv/lib/python3.13/site-packages/botocore/configprovider.py", "filename": "configprovider.py", "module": "configprovider", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 974, "funcName": "provide", "created": 1745585696.2781568, "msecs": 278.0, "relativeCreated": 68376.942976, "thread": 137596227127104, "threadName": "MainThread", "processName": "MainProcess", "process": 360708, "taskName": null}, {"name": "root", "msg": "mcg workspace set stdout: \u001b[96mname\u001b[0m:\u001b[92m br-se1\u001b[0m\n", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/home/henrique.luis/repos/s3-specs/src/s3_specs/docs/conftest.py", "filename": "conftest.py", "module": "conftest", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 138, "funcName": "active_mgc_workspace", "created": 1745585696.3025925, "msecs": 302.0, "relativeCreated": 68401.378795, "thread": 137596227127104, "threadName": "MainThread", "processName": "MainProcess", "process": 360708, "taskName": null}, {"name": "root", "msg": "Object test-generate-presig150f6e065070428d9ef2c65721a0ba7d-object uploaded to bucket test-generate-presig150f6e065070428d9ef2c65721a0ba7d", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/home/henrique.luis/repos/s3-specs/src/s3_specs/docs/tools/crud.py", "filename": "crud.py", "module": "crud", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 64, "funcName": "upload_object", "created": 1745585699.5626702, "msecs": 562.0, "relativeCreated": 71661.456541, "thread": 137596227127104, "threadName": "MainThread", "processName": "MainProcess", "process": 360708, "taskName": null}]}, "call": {"duration": 0.11718666099841357, "outcome": "failed", "crash": {"path": "/home/henrique.luis/repos/s3-specs/src/s3_specs/docs/bucket_sharing_cli.py", "lineno": 138, "message": "AssertionError: Failed to access presigned URL: Status 403\nassert 403 == 200\n +  where 403 = <Response [403]>.status_code"}, "traceback": [{"path": "src/s3_specs/docs/bucket_sharing_cli.py", "lineno": 138, "message": "AssertionError"}], "log": [{"name": "root", "msg": "Presigned URL generated: CompletedProcess(args=['mgc os objects presign --dst test-generate-presig150f6e065070428d9ef2c65721a0ba7d/test-generate-presig150f6e065070428d9ef2c65721a0ba7d-object --method PUT --no-confirm --raw'], returncode=0, stdout='2\\nurl: https://br-se1.magaluobjects.com/test-generate-presig150f6e065070428d9ef2c65721a0ba7d/test-generate-presig150f6e065070428d9ef2c65721a0ba7d-object?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=2390a002-50dd-4706-b738-3c9fde0e923c%2F20250425%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20250425T125459Z&X-Amz-Expires=300&X-Amz-Signature=ba3d3411062693d9414bedebcc4991179e2bf186990b1a8985b0f3d558e9f78f&X-Amz-SignedHeaders=host\\n\\n', stderr='')", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/home/henrique.luis/repos/s3-specs/src/s3_specs/docs/bucket_sharing_cli.py", "filename": "bucket_sharing_cli.py", "module": "bucket_sharing_cli", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 121, "funcName": "test_generate_presigned_url_cli", "created": 1745585699.5968015, "msecs": 596.0, "relativeCreated": 71695.587692, "thread": 137596227127104, "threadName": "MainThread", "processName": "MainProcess", "process": 360708, "taskName": null}, {"name": "root", "msg": "Validating access via presigned URL", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/home/henrique.luis/repos/s3-specs/src/s3_specs/docs/bucket_sharing_cli.py", "filename": "bucket_sharing_cli.py", "module": "bucket_sharing_cli", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 132, "funcName": "test_generate_presigned_url_cli", "created": 1745585699.5976238, "msecs": 597.0, "relativeCreated": 71696.41008, "thread": 137596227127104, "threadName": "MainThread", "processName": "MainProcess", "process": 360708, "taskName": null}, {"name": "root", "msg": "Request: <Response [403]>", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/home/henrique.luis/repos/s3-specs/src/s3_specs/docs/bucket_sharing_cli.py", "filename": "bucket_sharing_cli.py", "module": "bucket_sharing_cli", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 136, "funcName": "test_generate_presigned_url_cli", "created": 1745585699.680531, "msecs": 680.0, "relativeCreated": 71779.317245, "thread": 137596227127104, "threadName": "MainThread", "processName": "MainProcess", "process": 360708, "taskName": null}], "longrepr": "active_mgc_workspace = 'br-se1', profile_name = 'br-se1'\nfixture_bucket_with_one_object = ('test-generate-presig150f6e065070428d9ef2c65721a0ba7d', 'test-generate-presig150f6e065070428d9ef2c65721a0ba7d-object')\ncommand = {'command': 'mgc os objects presign --dst {bucket_name}/{object_key} --method {operation} --no-confirm --raw', 'expected': 'url'}\noperation = 'PUT'\n\n    @pytest.mark.parametrize(\"operation\", operations)\n    @pytest.mark.parametrize(\"command\", commands)\n    def test_generate_presigned_url_cli(\n        active_mgc_workspace,\n        profile_name,\n        fixture_bucket_with_one_object,\n        command,\n        operation\n        ):\n        \"\"\"\n        Test the generation and usage of presigned URLs via CLI commands.\n    \n        Parameters:\n        - active_mgc_workspace: Active workspace for MGC.\n        - profile_name: AWS profile name.\n        - fixture_bucket_with_one_object: Fixture providing a bucket and an object.\n        - command: CLI command template for generating presigned URLs.\n        - operation: S3 operation (e.g., GET, PUT).\n        \"\"\"\n    \n        bucket_name, object_key = fixture_bucket_with_one_object\n    \n        # Testing presigned URL generation\n        try:\n            # Format and execute the command\n            formatted_cmd = command['command'].format(\n                bucket_name=bucket_name,\n                profile_name=profile_name,\n                object_key=object_key,\n                operation=operation,\n            )\n            result = execute_subprocess(formatted_cmd)\n            logging.info(f\"Presigned URL generated: {result}\")\n    \n            # Validate the presigned URL\n            assert result is not None, \"Presigned URL was not generated\"\n    \n            # Extract the URL from the command output\n            match = re.search(r\"(?P<url>https?://[^\\s]+)\", result.stdout)\n            assert match, \"No valid URL found in the command output\"\n            presigned_url = match.group(\"url\")\n    \n            # Log the URL for debugging purposes\n            logging.info(\"Validating access via presigned URL\")\n    \n            # Perform a GET request to the presigned URL\n            response = requests.get(presigned_url)\n            logging.info(f\"Request: {response}\")\n            # Validate the response status and content\n>           assert response.status_code == 200, f\"Failed to access presigned URL: Status {response.status_code}\"\nE           AssertionError: Failed to access presigned URL: Status 403\nE           assert 403 == 200\nE            +  where 403 = <Response [403]>.status_code\n\nactive_mgc_workspace = 'br-se1'\nbucket_name = 'test-generate-presig150f6e065070428d9ef2c65721a0ba7d'\ncommand    = {'command': 'mgc os objects presign --dst {bucket_name}/{object_key} --method {operation} --no-confirm --raw', 'expected': 'url'}\nfixture_bucket_with_one_object = ('test-generate-presig150f6e065070428d9ef2c65721a0ba7d', 'test-generate-presig150f6e065070428d9ef2c65721a0ba7d-object')\nformatted_cmd = 'mgc os objects presign --dst test-generate-presig150f6e065070428d9ef2c65721a0ba7d/test-generate-presig150f6e065070428d9ef2c65721a0ba7d-object --method PUT --no-confirm --raw'\nmatch      = <re.Match object; span=(7, 434), match='https://br-se1.magaluobjects.com/test-generate-pr>\nobject_key = 'test-generate-presig150f6e065070428d9ef2c65721a0ba7d-object'\noperation  = 'PUT'\npresigned_url = 'https://br-se1.magaluobjects.com/test-generate-presig150f6e065070428d9ef2c65721a0ba7d/test-generate-presig150f6e06507...-Expires=300&X-Amz-Signature=ba3d3411062693d9414bedebcc4991179e2bf186990b1a8985b0f3d558e9f78f&X-Amz-SignedHeaders=host'\nprofile_name = 'br-se1'\nresponse   = <Response [403]>\nresult     = CompletedProcess(args=['mgc os objects presign --dst test-generate-presig150f6e065070428d9ef2c65721a0ba7d/test-generat...mz-Signature=ba3d3411062693d9414bedebcc4991179e2bf186990b1a8985b0f3d558e9f78f&X-Amz-SignedHeaders=host\\n\\n', stderr='')\n\nsrc/s3_specs/docs/bucket_sharing_cli.py:138: AssertionError"}, "teardown": {"duration": 0.9731677170020703, "outcome": "passed", "log": [{"name": "root", "msg": "Deleted object: test-generate-presig150f6e065070428d9ef2c65721a0ba7d-object from bucket: test-generate-presig150f6e065070428d9ef2c65721a0ba7d", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/home/henrique.luis/repos/s3-specs/src/s3_specs/docs/tools/crud.py", "filename": "crud.py", "module": "crud", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 178, "funcName": "delete_object", "created": 1745585700.2536206, "msecs": 253.0, "relativeCreated": 72352.406828, "thread": 137596053227072, "threadName": "ThreadPoolExecutor-0_0", "processName": "MainProcess", "process": 360708, "taskName": null}, {"name": "root", "msg": "Bucket 'test-generate-presig150f6e065070428d9ef2c65721a0ba7d' confirmed as deleted.", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/home/henrique.luis/repos/s3-specs/src/s3_specs/docs/tools/crud.py", "filename": "crud.py", "module": "crud", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 196, "funcName": "delete_bucket", "created": 1745585700.68846, "msecs": 688.0, "relativeCreated": 72787.24634, "thread": 137596227127104, "threadName": "MainThread", "processName": "MainProcess", "process": 360708, "taskName": null}]}}]}